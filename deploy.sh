#!/bin/bash

set -e

echo "üöÄ –î–µ–ø–ª–æ–π Meshtastic Frontend –Ω–∞ –ø–æ—Ä—Ç 82..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω
echo "‚èπÔ∏è  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker-compose down 2>/dev/null || true

# –£–¥–∞–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker rm -f meshtastic_taubetele_com_82 2>/dev/null || true

# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤..."
docker image prune -f

# –°–±–æ—Ä–∫–∞
echo "üî® –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞..."
docker-compose build --no-cache

# –ó–∞–ø—É—Å–∫
echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫..."
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞
echo "‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞..."
sleep 5

if docker ps | grep -q "meshtastic_taubetele_com_82"; then
    echo "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä meshtastic_taubetele_com_82 –∑–∞–ø—É—â–µ–Ω"
    echo "üåê –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 82"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞"
    docker-compose logs
    exit 1
fi

echo "üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
